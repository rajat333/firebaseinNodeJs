<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node-refresh-token\\node_modules\\ambi\\source\\index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>Import</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> typeChecker = <span class="hljs-built_in">require</span>(<span class="hljs-string">'typechecker'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Define</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ambi</span> (<span class="hljs-params">method, ...args</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Prepare</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">let</span> fireMethod, introspectMethod

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>If binding has occured then make sure we are introspecting the write method
by allowing the user to pass method as an array of two methods
the method to fire, and the method to introspect</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> ( typeChecker.isArray(method) ) {
		[fireMethod, introspectMethod] = method
	}
	<span class="hljs-keyword">else</span> {
		fireMethod = introspectMethod = method
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Extract the preceeding arguments and the completion callback</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">const</span> simpleArguments = args.slice(<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)
	<span class="hljs-keyword">const</span> completionCallback = args.slice(<span class="hljs-number">-1</span>)[<span class="hljs-number">0</span>]

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Check the completion callback is actually a function</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> ( !typeChecker.isFunction(completionCallback) ) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'ambi was called without a completion callback'</span>)
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Different ways functions can be called:
ambi(function(a,next){return next()}, a, next)</p>
<blockquote>
<p>VALID: execute asynchronously
given arguments are SAME as the accepted arguments
method will be fired with (a, next)
ambi(function(a,next){return next()}, next)
VALID: execute asynchronously
given arguments are LESS than the accepted arguments
method will be fired with (undefined, next)
ambi(function(a){}, a, next)
VALID: execute synchronously
given arguments are MORE than expected arguments
method will be fired with (a)
ambi(function(a){}, next)
INVALID: execute asynchronously
given arguments are SAME as the accepted arguments
method will be fired with (next)
if they want to use optional args, the function must accept a completion callback</p>
</blockquote>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">const</span> givenArgumentsLength = args.length
	<span class="hljs-keyword">const</span> acceptedArgumentsLength = introspectMethod.length
	<span class="hljs-keyword">let</span> argumentsDifferenceLength = <span class="hljs-literal">null</span>
	<span class="hljs-keyword">let</span> executeAsynchronously = <span class="hljs-literal">null</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Given arguments are SAME as the expected arguments
This will execute asynchronously
Don't have to do anything with the arguments</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> ( givenArgumentsLength === acceptedArgumentsLength ) {
		executeAsynchronously = <span class="hljs-literal">true</span>
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Given arguments are LESS than the expected arguments
This will execute asynchronously
We will need to supplement any missing expected arguments with undefined
to ensure the compeltion callback is in the right place in the arguments listing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( givenArgumentsLength &lt; acceptedArgumentsLength ) {
		executeAsynchronously = <span class="hljs-literal">true</span>
		argumentsDifferenceLength = acceptedArgumentsLength - givenArgumentsLength
		args = simpleArguments.slice().concat(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(argumentsDifferenceLength)).concat([completionCallback])
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Given arguments are MORE than the expected arguments
This will execute synchronously
We should to trim off the completion callback from the arguments
as the synchronous function won't care for it
while this isn't essential
it will provide some expectation for the user as to which mode their function was executed in</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">else</span> {
		executeAsynchronously = <span class="hljs-literal">false</span>
		args = simpleArguments.slice()
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Execute with the exceptation that the method will fire the completion callback itself</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span> ( executeAsynchronously ) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Fire the method</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		fireMethod(...args)
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Execute with the expectation that we will need to fire the completion callback ourselves
Always call the completion callback ourselves as the fire method does not make use of it</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Fire the method and check for returned errors</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		<span class="hljs-keyword">const</span> result = fireMethod(...args)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Check the result for a returned error</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		<span class="hljs-keyword">if</span> ( typeChecker.isError(result) ) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>An error was returned so fire the completion callback with the error</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">			<span class="hljs-keyword">const</span> err = result
			completionCallback(err)
		}
		<span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Everything worked, so fire the completion callback without an error and with the result</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">			completionCallback(<span class="hljs-literal">null</span>, result)
		}
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Return nothing as we expect ambi to deal with synchronous and asynchronous methods
so returning something will only work for synchronous methods
and not asynchronous ones
so returning anything would be inconsistent</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
