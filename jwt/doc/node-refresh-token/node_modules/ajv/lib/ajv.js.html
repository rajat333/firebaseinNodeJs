<!DOCTYPE html>
<html>
<head>
  <title>ajv.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node-refresh-token\\node_modules\\ajv\\lib\\ajv.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>ajv.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">var</span> compileSchema = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./compile'</span>)
  , resolve = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./compile/resolve'</span>)
  , Cache = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./cache'</span>)
  , SchemaObject = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./compile/schema_obj'</span>)
  , stableStringify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'json-stable-stringify'</span>)
  , formats = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./compile/formats'</span>)
  , rules = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./compile/rules'</span>)
  , v5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./v5'</span>)
  , util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./compile/util'</span>)
  , <span class="hljs-keyword">async</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./async'</span>)
  , co = <span class="hljs-built_in">require</span>(<span class="hljs-string">'co'</span>);

<span class="hljs-built_in">module</span>.exports = Ajv;

Ajv.prototype.compileAsync = <span class="hljs-keyword">async</span>.compile;

<span class="hljs-keyword">var</span> customKeyword = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./keyword'</span>);
Ajv.prototype.addKeyword = customKeyword.add;
Ajv.prototype.getKeyword = customKeyword.get;
Ajv.prototype.removeKeyword = customKeyword.remove;
Ajv.ValidationError = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./compile/validation_error'</span>);

<span class="hljs-keyword">var</span> META_SCHEMA_ID = <span class="hljs-string">'http://json-schema.org/draft-04/schema'</span>;
<span class="hljs-keyword">var</span> SCHEMA_URI_FORMAT = <span class="hljs-regexp">/^(?:(?:[a-z][a-z0-9+-.]*:)?\/\/)?[^\s]*$/i</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SCHEMA_URI_FORMAT_FUNC</span>(<span class="hljs-params">str</span>) </span>{
  <span class="hljs-keyword">return</span> SCHEMA_URI_FORMAT.test(str);
}

<span class="hljs-keyword">var</span> META_IGNORE_OPTIONS = [ <span class="hljs-string">'removeAdditional'</span>, <span class="hljs-string">'useDefaults'</span>, <span class="hljs-string">'coerceTypes'</span> ];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Creates validator instance.
Usage: <code>Ajv(opts)</code></p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opts</span>
<span class="dox_type">Object</span>
<span>optional options
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
<span>ajv instance
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Ajv</span>(<span class="hljs-params">opts</span>) </span>{
  <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> Ajv)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Ajv(opts);
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

  opts = <span class="hljs-keyword">this</span>._opts = util.copy(opts) || {};
  <span class="hljs-keyword">this</span>._schemas = {};
  <span class="hljs-keyword">this</span>._refs = {};
  <span class="hljs-keyword">this</span>._fragments = {};
  <span class="hljs-keyword">this</span>._formats = formats(opts.format);
  <span class="hljs-keyword">this</span>._cache = opts.cache || <span class="hljs-keyword">new</span> Cache;
  <span class="hljs-keyword">this</span>._loadingSchemas = {};
  <span class="hljs-keyword">this</span>._compilations = [];
  <span class="hljs-keyword">this</span>.RULES = rules();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>this is done on purpose, so that methods are bound to the instance
(without using bind) so that they can be used without the instance</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.validate = validate;
  <span class="hljs-keyword">this</span>.compile = compile;
  <span class="hljs-keyword">this</span>.addSchema = addSchema;
  <span class="hljs-keyword">this</span>.addMetaSchema = addMetaSchema;
  <span class="hljs-keyword">this</span>.validateSchema = validateSchema;
  <span class="hljs-keyword">this</span>.getSchema = getSchema;
  <span class="hljs-keyword">this</span>.removeSchema = removeSchema;
  <span class="hljs-keyword">this</span>.addFormat = addFormat;
  <span class="hljs-keyword">this</span>.errorsText = errorsText;

  <span class="hljs-keyword">this</span>._addSchema = _addSchema;
  <span class="hljs-keyword">this</span>._compile = _compile;

  opts.loopRequired = opts.loopRequired || <span class="hljs-literal">Infinity</span>;
  <span class="hljs-keyword">if</span> (opts.async || opts.transpile) <span class="hljs-keyword">async</span>.setup(opts);
  <span class="hljs-keyword">if</span> (opts.beautify === <span class="hljs-literal">true</span>) opts.beautify = { <span class="hljs-attr">indent_size</span>: <span class="hljs-number">2</span> };
  <span class="hljs-keyword">if</span> (opts.errorDataPath == <span class="hljs-string">'property'</span>) opts._errorDataPathProperty = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">this</span>._metaOpts = getMetaSchemaOptions();

  <span class="hljs-keyword">if</span> (opts.formats) addInitialFormats();
  addDraft4MetaSchema();
  <span class="hljs-keyword">if</span> (opts.v5) v5.enable(<span class="hljs-keyword">this</span>);
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts.meta == <span class="hljs-string">'object'</span>) addMetaSchema(opts.meta);
  addInitialSchemas();


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Validate data using schema
Schema will be compiled and cached (using serialized JSON as key. <a href="https://github.com/substack/json-stable-stringify">json-stable-stringify</a> is used to serialize.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">schemaKeyRef</span>
<span class="dox_type">String</span>
<span class="dox_type">Object</span>
<span>key, ref or schema object
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">data</span>
<span class="dox_type">Any</span>
<span>to be validated
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Boolean</span>
<span>validation result. Errors from the last validation will be available in <code>ajv.errors</code> (and also in compiled schema: <code>schema.errors</code>).
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span>(<span class="hljs-params">schemaKeyRef, data</span>) </span>{
    <span class="hljs-keyword">var</span> v;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> schemaKeyRef == <span class="hljs-string">'string'</span>) {
      v = getSchema(schemaKeyRef);
      <span class="hljs-keyword">if</span> (!v) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'no schema with key or ref "'</span> + schemaKeyRef + <span class="hljs-string">'"'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">var</span> schemaObj = _addSchema(schemaKeyRef);
      v = schemaObj.validate || _compile(schemaObj);
    }

    <span class="hljs-keyword">var</span> valid = v(data);
    <span class="hljs-keyword">if</span> (v.$<span class="hljs-keyword">async</span> === <span class="hljs-literal">true</span>)
      <span class="hljs-keyword">return</span> self._opts.async == <span class="hljs-string">'*'</span> ? co(valid) : valid;
    self.errors = v.errors;
    <span class="hljs-keyword">return</span> valid;
  }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Create validating function for passed schema.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">schema</span>
<span class="dox_type">Object</span>
<span>schema object
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">_meta</span>
<span class="dox_type">Boolean</span>
<span>true if schema is a meta-schema. Used internally to compile meta schemas of custom keywords.
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Function</span>
<span>validating function
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compile</span>(<span class="hljs-params">schema, _meta</span>) </span>{
    <span class="hljs-keyword">var</span> schemaObj = _addSchema(schema, <span class="hljs-literal">undefined</span>, _meta);
    <span class="hljs-keyword">return</span> schemaObj.validate || _compile(schemaObj);
  }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds schema to the instance.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">schema</span>
<span class="dox_type">Object</span>
<span class="dox_type">Array</span>
<span>schema or array of schemas. If array is passed, <code>key</code> and other parameters will be ignored.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">key</span>
<span class="dox_type">String</span>
<span>Optional schema key. Can be passed to <code>validate</code> method instead of schema object or id/ref. One schema per instance can have empty <code>id</code> and <code>key</code>.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">_skipValidation</span>
<span class="dox_type">Boolean</span>
<span>true to skip schema validation. Used internally, option validateSchema should be used instead.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">_meta</span>
<span class="dox_type">Boolean</span>
<span>true if schema is a meta-schema. Used internally, addMetaSchema should be used instead.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSchema</span>(<span class="hljs-params">schema, key, _skipValidation, _meta</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(schema)){
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;schema.length; i++) addSchema(schema[i], <span class="hljs-literal">undefined</span>, _skipValidation, _meta);
      <span class="hljs-keyword">return</span>;
    }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>can key/id have # inside?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    key = resolve.normalizeId(key || schema.id);
    checkUnique(key);
    self._schemas[key] = _addSchema(schema, _skipValidation, _meta, <span class="hljs-literal">true</span>);
  }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>Add schema that will be used to validate other schemas
options in META_IGNORE_OPTIONS are alway set to false</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">schema</span>
<span class="dox_type">Object</span>
<span>schema object
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">key</span>
<span class="dox_type">String</span>
<span>optional schema key
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">skipValidation</span>
<span class="dox_type">Boolean</span>
<span>true to skip schema validation, can be used to override validateSchema option for meta-schema
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addMetaSchema</span>(<span class="hljs-params">schema, key, skipValidation</span>) </span>{
    addSchema(schema, key, skipValidation, <span class="hljs-literal">true</span>);
  }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Validate schema</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">schema</span>
<span class="dox_type">Object</span>
<span>schema to validate
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">throwOrLogError</span>
<span class="dox_type">Boolean</span>
<span>pass true to throw (or log) an error if invalid
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Boolean</span>
<span>true if schema is valid
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateSchema</span>(<span class="hljs-params">schema, throwOrLogError</span>) </span>{
    <span class="hljs-keyword">var</span> $schema = schema.$schema || self._opts.defaultMeta || defaultMeta();
    <span class="hljs-keyword">var</span> currentUriFormat = self._formats.uri;
    self._formats.uri = <span class="hljs-keyword">typeof</span> currentUriFormat == <span class="hljs-string">'function'</span>
                        ? SCHEMA_URI_FORMAT_FUNC
                        : SCHEMA_URI_FORMAT;
    <span class="hljs-keyword">var</span> valid;
    <span class="hljs-keyword">try</span> { valid = validate($schema, schema); }
    <span class="hljs-keyword">finally</span> { self._formats.uri = currentUriFormat; }
    <span class="hljs-keyword">if</span> (!valid &amp;&amp; throwOrLogError) {
      <span class="hljs-keyword">var</span> message = <span class="hljs-string">'schema is invalid: '</span> + errorsText();
      <span class="hljs-keyword">if</span> (self._opts.validateSchema == <span class="hljs-string">'log'</span>) <span class="hljs-built_in">console</span>.error(message);
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(message);
    }
    <span class="hljs-keyword">return</span> valid;
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defaultMeta</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> meta = self._opts.meta;
    self._opts.defaultMeta = <span class="hljs-keyword">typeof</span> meta == <span class="hljs-string">'object'</span>
                              ? meta.id || meta
                              : self._opts.v5
                                ? v5.META_SCHEMA_ID
                                : META_SCHEMA_ID;
    <span class="hljs-keyword">return</span> self._opts.defaultMeta;
  }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get compiled schema from the instance by <code>key</code> or <code>ref</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">keyRef</span>
<span class="dox_type">String</span>
<span><code>key</code> that was passed to <code>addSchema</code> or full schema reference (<code>schema.id</code> or resolved id).
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Function</span>
<span>schema validating function (with property <code>schema</code>).
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSchema</span>(<span class="hljs-params">keyRef</span>) </span>{
    <span class="hljs-keyword">var</span> schemaObj = _getSchemaObj(keyRef);
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">typeof</span> schemaObj) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'object'</span>: <span class="hljs-keyword">return</span> schemaObj.validate || _compile(schemaObj);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'string'</span>: <span class="hljs-keyword">return</span> getSchema(schemaObj);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'undefined'</span>: <span class="hljs-keyword">return</span> _getSchemaFragment(keyRef);
    }
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getSchemaFragment</span>(<span class="hljs-params">ref</span>) </span>{
    <span class="hljs-keyword">var</span> res = resolve.schema.call(self, { <span class="hljs-attr">schema</span>: {} }, ref);
    <span class="hljs-keyword">if</span> (res) {
      <span class="hljs-keyword">var</span> schema = res.schema
        , root = res.root
        , baseId = res.baseId;
      <span class="hljs-keyword">var</span> v = compileSchema.call(self, schema, root, <span class="hljs-literal">undefined</span>, baseId);
      self._fragments[ref] = <span class="hljs-keyword">new</span> SchemaObject({
        <span class="hljs-attr">ref</span>: ref,
        <span class="hljs-attr">fragment</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">schema</span>: schema,
        <span class="hljs-attr">root</span>: root,
        <span class="hljs-attr">baseId</span>: baseId,
        <span class="hljs-attr">validate</span>: v
      });
      <span class="hljs-keyword">return</span> v;
    }
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getSchemaObj</span>(<span class="hljs-params">keyRef</span>) </span>{
    keyRef = resolve.normalizeId(keyRef);
    <span class="hljs-keyword">return</span> self._schemas[keyRef] || self._refs[keyRef] || self._fragments[keyRef];
  }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<div class="dox">
<div class="summary">
<p>Remove cached schema(s).
If no parameter is passed all schemas but meta-schemas are removed.
If RegExp is passed all schemas with key/id matching pattern but meta-schemas are removed.
Even if schema is referenced by other schemas it still can be removed as other schemas have local references.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">schemaKeyRef</span>
<span class="dox_type">String</span>
<span class="dox_type">Object</span>
<span class="dox_type">RegExp</span>
<span>key, ref, pattern to match key/ref or schema object
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeSchema</span>(<span class="hljs-params">schemaKeyRef</span>) </span>{
    <span class="hljs-keyword">if</span> (schemaKeyRef <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) {
      _removeAllSchemas(self._schemas, schemaKeyRef);
      _removeAllSchemas(self._refs, schemaKeyRef);
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">typeof</span> schemaKeyRef) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'undefined'</span>:
        _removeAllSchemas(self._schemas);
        _removeAllSchemas(self._refs);
        self._cache.clear();
        <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'string'</span>:
        <span class="hljs-keyword">var</span> schemaObj = _getSchemaObj(schemaKeyRef);
        <span class="hljs-keyword">if</span> (schemaObj) self._cache.del(schemaObj.jsonStr);
        <span class="hljs-keyword">delete</span> self._schemas[schemaKeyRef];
        <span class="hljs-keyword">delete</span> self._refs[schemaKeyRef];
        <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'object'</span>:
        <span class="hljs-keyword">var</span> jsonStr = stableStringify(schemaKeyRef);
        self._cache.del(jsonStr);
        <span class="hljs-keyword">var</span> id = schemaKeyRef.id;
        <span class="hljs-keyword">if</span> (id) {
          id = resolve.normalizeId(id);
          <span class="hljs-keyword">delete</span> self._schemas[id];
          <span class="hljs-keyword">delete</span> self._refs[id];
        }
    }
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_removeAllSchemas</span>(<span class="hljs-params">schemas, regex</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> keyRef <span class="hljs-keyword">in</span> schemas) {
      <span class="hljs-keyword">var</span> schemaObj = schemas[keyRef];
      <span class="hljs-keyword">if</span> (!schemaObj.meta &amp;&amp; (!regex || regex.test(keyRef))) {
        self._cache.del(schemaObj.jsonStr);
        <span class="hljs-keyword">delete</span> schemas[keyRef];
      }
    }
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_addSchema</span>(<span class="hljs-params">schema, skipValidation, meta, shouldAddSchema</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> schema != <span class="hljs-string">'object'</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'schema should be object'</span>);
    <span class="hljs-keyword">var</span> jsonStr = stableStringify(schema);
    <span class="hljs-keyword">var</span> cached = self._cache.get(jsonStr);
    <span class="hljs-keyword">if</span> (cached) <span class="hljs-keyword">return</span> cached;

    shouldAddSchema = shouldAddSchema || self._opts.addUsedSchema !== <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">var</span> id = resolve.normalizeId(schema.id);
    <span class="hljs-keyword">if</span> (id &amp;&amp; shouldAddSchema) checkUnique(id);

    <span class="hljs-keyword">var</span> willValidate = self._opts.validateSchema !== <span class="hljs-literal">false</span> &amp;&amp; !skipValidation;
    <span class="hljs-keyword">var</span> recursiveMeta;
    <span class="hljs-keyword">if</span> (willValidate &amp;&amp; !(recursiveMeta = schema.id &amp;&amp; schema.id == schema.$schema))
      validateSchema(schema, <span class="hljs-literal">true</span>);

    <span class="hljs-keyword">var</span> localRefs = resolve.ids.call(self, schema);

    <span class="hljs-keyword">var</span> schemaObj = <span class="hljs-keyword">new</span> SchemaObject({
      <span class="hljs-attr">id</span>: id,
      <span class="hljs-attr">schema</span>: schema,
      <span class="hljs-attr">localRefs</span>: localRefs,
      <span class="hljs-attr">jsonStr</span>: jsonStr,
      <span class="hljs-attr">meta</span>: meta
    });

    <span class="hljs-keyword">if</span> (id[<span class="hljs-number">0</span>] != <span class="hljs-string">'#'</span> &amp;&amp; shouldAddSchema) self._refs[id] = schemaObj;
    self._cache.put(jsonStr, schemaObj);

    <span class="hljs-keyword">if</span> (willValidate &amp;&amp; recursiveMeta) validateSchema(schema, <span class="hljs-literal">true</span>);

    <span class="hljs-keyword">return</span> schemaObj;
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_compile</span>(<span class="hljs-params">schemaObj, root</span>) </span>{
    <span class="hljs-keyword">if</span> (schemaObj.compiling) {
      schemaObj.validate = callValidate;
      callValidate.schema = schemaObj.schema;
      callValidate.errors = <span class="hljs-literal">null</span>;
      callValidate.root = root ? root : callValidate;
      <span class="hljs-keyword">if</span> (schemaObj.schema.$<span class="hljs-keyword">async</span> === <span class="hljs-literal">true</span>)
        callValidate.$<span class="hljs-keyword">async</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span> callValidate;
    }
    schemaObj.compiling = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">var</span> currentOpts;
    <span class="hljs-keyword">if</span> (schemaObj.meta) {
      currentOpts = self._opts;
      self._opts = self._metaOpts;
    }

    <span class="hljs-keyword">var</span> v;
    <span class="hljs-keyword">try</span> { v = compileSchema.call(self, schemaObj.schema, root, schemaObj.localRefs); }
    <span class="hljs-keyword">finally</span> {
      schemaObj.compiling = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (schemaObj.meta) self._opts = currentOpts;
    }

    schemaObj.validate = v;
    schemaObj.refs = v.refs;
    schemaObj.refVal = v.refVal;
    schemaObj.root = v.root;
    <span class="hljs-keyword">return</span> v;


    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callValidate</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> _validate = schemaObj.validate;
      <span class="hljs-keyword">var</span> result = _validate.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>);
      callValidate.errors = _validate.errors;
      <span class="hljs-keyword">return</span> result;
    }
  }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<div class="dox">
<div class="summary">
<p>Convert array of error message objects to string</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">errors</span>
<span class="dox_type">Array.&lt;Object&gt;</span>
<span>optional array of validation errors, if not passed errors from the instance are used.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">Object</span>
<span>optional options with properties <code>separator</code> and <code>dataVar</code>.
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
<span>human readable string with all errors descriptions
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errorsText</span>(<span class="hljs-params">errors, options</span>) </span>{
    errors = errors || self.errors;
    <span class="hljs-keyword">if</span> (!errors) <span class="hljs-keyword">return</span> <span class="hljs-string">'No errors'</span>;
    options = options || {};
    <span class="hljs-keyword">var</span> separator = options.separator === <span class="hljs-literal">undefined</span> ? <span class="hljs-string">', '</span> : options.separator;
    <span class="hljs-keyword">var</span> dataVar = options.dataVar === <span class="hljs-literal">undefined</span> ? <span class="hljs-string">'data'</span> : options.dataVar;

    <span class="hljs-keyword">var</span> text = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;errors.length; i++) {
      <span class="hljs-keyword">var</span> e = errors[i];
      <span class="hljs-keyword">if</span> (e) text += dataVar + e.dataPath + <span class="hljs-string">' '</span> + e.message + separator;
    }
    <span class="hljs-keyword">return</span> text.slice(<span class="hljs-number">0</span>, -separator.length);
  }


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>Add custom format</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">String</span>
<span>format name
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">format</span>
<span class="dox_type">String</span>
<span class="dox_type">RegExp</span>
<span class="dox_type">Function</span>
<span>string is converted to RegExp; function should return boolean (true when valid)
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addFormat</span>(<span class="hljs-params">name, format</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> format == <span class="hljs-string">'string'</span>) format = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(format);
    self._formats[name] = format;
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addDraft4MetaSchema</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (self._opts.meta !== <span class="hljs-literal">false</span>) {
      <span class="hljs-keyword">var</span> metaSchema = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./refs/json-schema-draft-04.json'</span>);
      addMetaSchema(metaSchema, META_SCHEMA_ID, <span class="hljs-literal">true</span>);
      self._refs[<span class="hljs-string">'http://json-schema.org/schema'</span>] = META_SCHEMA_ID;
    }
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addInitialSchemas</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> optsSchemas = self._opts.schemas;
    <span class="hljs-keyword">if</span> (!optsSchemas) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(optsSchemas)) addSchema(optsSchemas);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> optsSchemas) addSchema(optsSchemas[key], key);
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addInitialFormats</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> name <span class="hljs-keyword">in</span> self._opts.formats) {
      <span class="hljs-keyword">var</span> format = self._opts.formats[name];
      addFormat(name, format);
    }
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkUnique</span>(<span class="hljs-params">id</span>) </span>{
    <span class="hljs-keyword">if</span> (self._schemas[id] || self._refs[id])
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'schema with key or id "'</span> + id + <span class="hljs-string">'" already exists'</span>);
  }


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMetaSchemaOptions</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> metaOpts = util.copy(self._opts);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;META_IGNORE_OPTIONS.length; i++)
      <span class="hljs-keyword">delete</span> metaOpts[META_IGNORE_OPTIONS[i]];
    <span class="hljs-keyword">return</span> metaOpts;
  }
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
